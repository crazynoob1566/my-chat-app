workflows:
  ios-workflow:
    name: iOS Build (Free Account)
    environment:
      flutter: stable  # Используем стабильную версию
      groups:
        - supabase_credentials
      xcode: latest
      cocoapods: default
    scripts:
      - name: Debug Flutter version
        script: |
          echo "Flutter version:"
          flutter --version
          echo "Dart version:"
          dart --version
      - name: Set up Flutter
        script: |
          flutter config --no-analytics
          flutter packages pub get
      - name: Generate Flutter files
        script: |
          cd $CM_BUILD_DIR
          flutter pub get
          flutter build ios --config-only --no-codesign
      - name: Build IPA without code signing
        script: |
          cd $CM_BUILD_DIR
          flutter build ipa \
            --release \
            --no-codesign \
            --export-options-plist="$CM_BUILD_DIR/ios/exportOptions.plist"
    artifacts:
      - build/ios/ipa/*.ipa
    publishing:
      email:
        recipients:
          - your-email@example.com