workflows:
  ios-workflow:
    name: iOS Build (Free Account)
    environment:
      groups:
        - supabase_credentials
      xcode: latest
      cocoapods: default
    scripts:
      - name: Set up Flutter
        script: |
          flutter packages pub get
      - name: Generate Flutter files
        script: |
          cd $CM_BUILD_DIR
          flutter pub get
          # Генерируем необходимые файлы конфигурации
          flutter build ios --config-only --no-codesign
      - name: Build IPA without code signing
        script: |
          cd $CM_BUILD_DIR
          # Используем flutter build ipa с параметром --no-codesign
          flutter build ipa \
            --release \
            --no-codesign \
            --export-options-plist="$CM_BUILD_DIR/ios/exportOptions.plist"
    artifacts:
      - build/ios/ipa/*.ipa
    publishing:
      email:
        recipients:
          - your-email@example.com